{% extends "base.html" %}

{% block title %}Dashboard â€” Obsidian Note Linker{% endblock %}

{% block content %}
<h1>Dashboard</h1>
<p>Vault: <code>{{ vault_path }}</code></p>

<div class="grid">
    <article>
        <header><strong>Notes in Vault</strong></header>
        <p style="font-size: 2rem; text-align: center;">
            {% if status %}{{ status.total_notes_in_vault }}{% else %}&mdash;{% endif %}
        </p>
        <footer><small>Markdown files found</small></footer>
    </article>

    <article>
        <header><strong>Notes Indexed</strong></header>
        <p style="font-size: 2rem; text-align: center;">
            {% if status %}{{ status.notes_indexed }}{% else %}&mdash;{% endif %}
        </p>
        <footer>
            <small>
                {% if status and status.notes_needing_indexing > 0 %}
                    {{ status.notes_needing_indexing }} note{{ "s" if status.notes_needing_indexing != 1 }} need indexing
                {% elif status %}
                    All notes indexed
                {% else %}
                    Unable to determine status
                {% endif %}
            </small>
        </footer>
    </article>

    <article>
        <header><strong>Candidates Found</strong></header>
        <p style="font-size: 2rem; text-align: center;">
            {% if candidate_count is not none %}
                {{ candidate_count }}
            {% else %}
                <span style="opacity: 0.4;">&mdash;</span>
            {% endif %}
        </p>
        <footer>
            <small>
                {% if candidate_count is not none %}
                    Pairs to review
                {% else %}
                    Run indexing to generate candidates
                {% endif %}
            </small>
        </footer>
    </article>
</div>

<div id="indexing-area">
    {% if is_indexing %}
        <article>
            <header><strong>Indexing in Progress</strong></header>
            <progress></progress>
            <p>Indexing is running in another tab or session.</p>
        </article>
    {% elif status and status.notes_needing_indexing > 0 %}
        <button hx-get="/indexing/start" hx-target="#indexing-area" hx-swap="innerHTML">
            Index Now ({{ status.notes_needing_indexing }} note{{ "s" if status.notes_needing_indexing != 1 }})
        </button>
    {% elif status and status.notes_indexed > 0 %}
        <button hx-get="/indexing/start" hx-target="#indexing-area" hx-swap="innerHTML">
            Re-index All
        </button>
        <small>All notes are up to date. Click to force re-check.</small>
    {% else %}
        <button hx-get="/indexing/start" hx-target="#indexing-area" hx-swap="innerHTML">
            Index Now
        </button>
        <small>Add markdown notes to your vault, then click to index.</small>
    {% endif %}
</div>
{% endblock %}
